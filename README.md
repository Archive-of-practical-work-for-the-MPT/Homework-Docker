# Курсовой проект "GreenQuality Airlines" - веб-приложение для авиакомпании

<p align="center">
      <img src="https://github.com/user-attachments/assets/e3716f65-3e9e-40c0-bfab-ccdb5d8a6c0d" alt="Лого" width="700">
</p>

## О проекте

GreenQuality Airlines - это современное веб-приложение для авиакомпании, разработанное с использованием фреймворка Django. Проект представляет собой полнофункциональный сайт авиакомпании с интуитивным интерфейсом и привлекательным дизайном.

## Брендбук

<p align="center">
      <img src="https://github.com/user-attachments/assets/f0be8396-f120-4137-b52d-1ae32af76229" alt="Брендбук" width="400">
      <img src="https://github.com/user-attachments/assets/07dd9a37-d379-484c-824c-62931bb7a3e5" alt="Брендбук" width="350">
</p>

<p align="center">
      
</p>

## Демонстрация

<p align="center">
      <img src="https://github.com/user-attachments/assets/351da2dc-1262-4bd9-bc85-d5bbe5ccbfb1" alt="Демонстрация" width="700">
</p>

<p align="center">
      <img src="https://github.com/user-attachments/assets/7f9b9bb8-fa4b-4376-9b47-06cb92f89fa0" alt="Демонстрация" width="700">
</p>

## Требования
<details>
<summary>Нажмите чтобы расскрыть</summary>

1. Цель
Спроектировать, реализовать и задокументировать защищённую клиент-серверную
информационную систему на базе СУБД. В проекте должны быть продемонстрированы:
анализ предметной области, проектирование БД, серверная логика
(SQL/процедуры/триггеры/транзакции), защита информации, администрирование
(резервное копирование и восстановление), API и клиентский интерфейс,
аналитика/отчёты, тестирование и культура разработки (Git).
2. Конечные результаты (что сдаётся)
   1. Работоспособная система (локально либо в контейнерах).
   2. Репозиторий Git c историей разработки.
   3. Пояснительная записка (структура ниже).
   4. Набор тестовых данных и отчётов по тестированию.
   5. Полный комплект скриптов БД (создание, миграции, начальное наполнение, бэкап/restore).
   6. Спецификация API (OpenAPI/другой формат), инструкция запуска, руководство пользователя.
3. Функциональные требования
   3.1. База данных
   * Минимум 8 таблиц предметной области.
   * Нормализация не ниже 3НФ.
   * Реальные связи 1:1, 1:М и М:М; внешние ключи, ограничения целостности (NOT NULL, CHECK, UNIQUE).
   * Представления (VIEW) для удобного чтения/отчётности.
   * Серверная валидация данных (ограничения, триггеры/процедуры).
   3.2. SQL и серверная логика
   * Полный CRUD по ключевым сущностям.
   * Не менее 3 хранимых процедур (бизнес-операции: расчёты, пакетные изменения и т. п.).
   * Функции/триггеры для аудита.
   * Транзакции с обработкой ошибок (атомарность бизнес-операций).
   * Обработка исключений и возврат человекочитаемых кодов/сообщений на уровень API.
   3.3. Безопасность и администрирование
   * Ролевая модель доступа (RBAC), минимум 3 роли (пример: администратор, пользователь, гость/читатель).
   * Хранение паролей в виде безопасного хэша шифрование/маскирование критичных полей.
   * Журнал аудита: кто/когда/что менял (до/после).
   * Регламент резервного копирования и восстановление (демонстрация restore на учебном стенде).
   * Конфигурация доступа к БД и секретов (env-переменные/конфиг на сервере).
   3.4. Клиент-серверное приложение и API
   * Клиент (веб или десктоп) с аутентификацией и работой по ролям.
   * API (REST или gRPC) для всех основных операций; спецификация (OpenAPI/описание методов, параметры, коды ошибок, примеры).
   * Импорт/экспорт данных: минимум CSV и SQL-скрипты (дамп/миграции).
   * Адаптивный интерфейс (не менее 3 брейкпоинтов).
   * Настройки пользователя (тема, формат даты/чисел, размер страниц, сохранённые фильтры) — хранятся на сервере.
   * Горячие клавиши (не менее 8) для частых операций.
   * Брендбук интерфейса: палитра, шрифты, сетка, иконки; применение единых стилей в UI.
   3.5. Статистика и отчёты
   * Подсистема аналитики: сводные таблицы и минимум 2–3 визуализации (диаграммы/графики).
   * Фильтры, период, экспорт отчётов в CSV (и/или изображения отчётов).
   3.6. Работа с Git
   * Публичный или учебный репозиторий (GitHub/GitLab).
   * README с инструкцией по запуску (локально/в контейнерах), описанием архитектуры и ролей.
4. Тестирование (обязательный минимум и артефакты)
* Функциональное: CRUD, поиск/сортировки/фильтры, роли, процедуры/триггеры, транзакции.
* Интеграционное: взаимодействие сервисов и API, импорт/экспорт.
* Нагрузочное: массовые операции/пакетные транзакции (описать профиль нагрузки).
* Безопасность: попытки SQL-инъекций, проверка разграничения прав, корректность шифрования/маскирования.
* Отказоустойчивость: имитация сбоя и восстановление из резервной копии (подтверждение целостности).
* Автоматизация: unit-тесты серверной логики и/или API; при возможности — запуск через CI.
* На выходе: тест-план, тест-кейсы, журналы прогонов, отчёт о дефектах, итоговый отчёт.
5. Пояснительная записка (структура и наполнение)
  5.1. Введение
  * Цель, задачи, актуальность, краткое описание предметной области.
  5.2. Общая часть
  * Постановка задачи.
  * Входные/выходные данные, основные роли и сценарии пользователей.
  5.3. Специальная часть
  * Внешняя спецификация (бизнес-процессы, методы, сценарии, тесты на уровне требований).
  * Проектирование:
    − ER-диаграмма и словарь данных. o Структурная схема БД и обоснование ключевых ограничений.
    − Диаграмма классов/сервисов (если применимо).
    − Схема пользовательских интерфейсов (навигация/макеты/состояния).
    − Схема архитектуры
    − Схема тестирования (пирамиды тестов, инструменты, метрики качества).
  * Описание мер защиты (RBAC, шифрование, аудит, политика хранения ПДн/секретов).
  * Описание бэкапов и процедуры восстановления (включая частоту, хранение, шаги restore).
  5.4. Технологическая часть
  * Используемые языки/СУБД/фреймворки/инструменты.
  * Процесс разработки и отладки (ветвление, код-ревью, линтеры/форматтеры).
  * Защитное программирование (валидации, обработка ошибок, идемпотентность).
  * DevOps-схема (Docker Compose/контейнеризация, переменные окружения, сборка, CI/CD при наличии).
  * Характеристики системы: производительность (целевые профили), безопасность (угрозы/меры), эксплуатационные регламенты.
  5.5. Список источников
  * Нормативы/ГОСТы (при наличии), учебные и справочные материалы, статьи/мануалы.
  5.6. Приложения
  * Исходные коды (ссылка на репозиторий), миграции/скрипты БД, дампы.
  * Руководство пользователя.
  * Тест-планы/кейсы/отчёты, наборы тестовых данных.
  * Экспортированные отчёты/визуализации.
6. Критерии приёмки (без раскрытия внутренней шкалы)
* Система разворачивается по инструкции и работает в заявленном окружении.
* Все обязательные функции реализованы на стороне сервера с корректной валидацией и разграничением прав.
* Бизнес-операции выполняются атомарно (транзакции); действия фиксируются в журнале аудита.
* Данные защищены (хэш паролей, шифрование/маскирование критичных полей).
* Импорт/экспорт работает с предпросмотром и отчётом об ошибках (если предусмотрено).
* Аналитика формирует своды и диаграммы по фильтрам, экспортирует результаты.
* Выполнены виды тестирования, предоставлены артефакты.
* Резервное копирование и восстановление показаны на учебном стенде.
* Репозиторий оформлен, история коммитов прозрачна, командная работа отражена.
* Пояснительная записка полная, логичная, без противоречий между текстом и реализованной системой.
7. Соответствие профессиональным компетенциям
ПК 11.1: сбор, обработка и анализ информации для проектирования БД — разделы
«Общая/Специальная часть», ER-диаграмма, словарь данных.
ПК 11.2: проектирование БД на основе анализа предметной области — нормализация до
3НФ, схемы, ограничения.
ПК 11.3: разработка объектов БД — таблицы, представления, индексы, процедуры,
функции, триггеры.
ПК 11.4: реализация БД в СУБД — миграции/скрипты, наполнение, эксплуатация.
ПК 11.5: администрирование БД — резервное копирование, восстановление, аудит,
журналы, конфигурации.
ПК 11.6: защита информации в БД — RBAC, хэширование/шифрование, серверная
валидация, защита от SQL-инъекций.
8. Организационные требования
* Сроки и контрольные точки — по календарному плану преподавателя.
* Все артефакты (коды, схемы, отчёты, дампы) должны быть актуальны на момент защиты и воспроизводимы по инструкции запуска.
* Любые заимствования и генерация кода/текста — с указанием источников; при защите требуется устное объяснение принятых решений.

</details>

## Технологии
- Django 5.2 - мощный Python веб-фреймворк
- Python 3.13.9 - интерпретатор Python
- HTML5, CSS3 с современными свойствами (grid, flexbox, backdrop-filter)
- JavaScript для интерактивных элементов
- PostgreSQL 16 для локального хранения данных

## Архитектура

Проект построен как классическое Django-приложение с одним основным приложением `airline`.

### Структура проекта
- **`greenquality/`** — корень Django-проекта: настройки (`settings.py`), главный роутинг (`urls.py`), `manage.py`.
- **`greenquality/airline/`** — приложение авиакомпании:
  - **`models.py`** — модели данных: роли, аккаунты, пользователи, аэропорты, самолёты, рейсы, билеты, платежи, пассажиры, багаж, журнал аудита.
  - **`views.py`** — представления для публичных страниц (главная, о нас, контакты, рейсы), авторизации, профиля, покупки билета, бэкапа/восстановления БД.
  - **`admin_views.py`** — представления для панели администратора (CRUD по всем таблицам) и панели менеджера (ограниченный CRUD, отчётность).
  - **`forms.py`** — формы с валидацией (например, профиль пользователя).
  - **`db_reports.py`** — отчёты и процедуры БД (выручка, статистика).
  - **`audit_utils.py`** — запись операций в журнал аудита при изменении данных через CRUD.
  - **`templates/`** — HTML-шаблоны; базовый шаблон `base.html`, темы (светлая/тёмная).
  - **`static/`** — CSS, изображения.
- **`scripts/`** — скрипты инициализации БД: создание таблиц (`create_tables.sql`), триггеры (`triggers.sql`), процедуры и представления (`procedures_views.sql`), начальные данные (`insert_initial_data.sql`), Python-скрипт `setup_database.py`.

### Поток данных
- Пользователь входит по email/паролю; роль хранится в таблице `roles`, связь — `accounts.role_id`.
- Публичные страницы доступны без входа; рейсы отображаются из БД с пагинацией.
- Покупка билета: выбор рейса → выбор места → ввод пассажира и оплата; создаются записи в `payments`, `tickets`, `passengers` и связанных таблицах.
- Админ и менеджер получают разный набор вкладок в профиле и разный доступ к CRUD и отчётам (см. раздел «Роли»).

### Роли пользователей

В системе используются три роли (таблица `roles`, поле `role_name`). Роль назначается аккаунту при регистрации или вручную в панели администратора.

| Роль    | Код     | Описание и возможности |
|---------|--------|-------------------------|
| **Пользователь** | `USER`  | Роль по умолчанию при регистрации. Доступ: главная, рейсы, о нас, контакты, регистрация/вход, **профиль** (личные данные, история покупок билетов). Может покупать билеты. |
| **Менеджер**    | `MANAGER` | Расширенный доступ. Всё то же, что у пользователя, плюс: **панель менеджера** (отдельный пункт меню), CRUD по рейсам, пассажирам, платежам, билетам, багажу; вкладки профиля «Статистика» и «Отчётность»; экспорт статистики (CSV/PDF). Доступа к резервному копированию и полному CRUD по всем таблицам нет. |
| **Администратор** | `ADMIN` | Полный доступ. Всё то же, что у менеджера, плюс: **панель администратора** (CRUD по всем таблицам: роли, аккаунты, пользователи, аэропорты, самолёты, рейсы, пассажиры, классы, платежи, билеты, типы багажа, багаж); в профиле — вкладки «Статистика», «Отчётность», **«Восстановление»** (создание резервной копии БД и восстановление из .sql). Все изменения через админ-CRUD пишутся в журнал аудита. |

Проверка роли в коде выполняется по `account.role_id.role_name` (значения `'USER'`, `'MANAGER'`, `'ADMIN'`). Доступ к панелям и к бэкапу/восстановлению запрещён при несоответствующей роли.

## Как запустить проект?

### Требования
- Python >3.11
- PostgreSQL >16 (установлен и запущен)
- Учётная запись с правами на создание БД (обычно `postgres`)

### Шаги

1. **Клонируйте репозиторий и перейдите в корень проекта**
   ```bash
   git clone https://github.com/Archive-of-practical-work-for-the-MPT/GreenQuality.git
   cd GreenQuality
   ```

2. **Создайте виртуальное окружение и установите зависимости**
   ```bash
   python -m venv venv
   # Windows:
   .\venv\Scripts\activate
   # macOS/Linux:
   source venv/bin/activate

   pip install -r requirements.txt
   ```

3. **Настройте переменные окружения**
   - Скопируйте `.env.example` в `.env`
   - Укажите в `.env` пароль PostgreSQL (`DB_PASSWORD`) и при необходимости `DB_HOST`, `DB_PORT`
   - На Windows, если `pg_dump`/`psql` не в PATH, раскомментируйте и укажите `PG_BIN_PATH` (например: `C:\Program Files\PostgreSQL\16\bin`)

4. **Создайте базу данных, таблицы, триггеры, процедуры и представления**
   ```bash
   python scripts/setup_database.py
   ```
   Эта команда по очереди:
   - создаёт БД `greenquality`, если её ещё нет;
   - выполняет `create_tables.sql` (удаляет старые таблицы при наличии и создаёт заново);
   - выполняет `triggers.sql` (триггеры аудита и генерации билетов);
   - выполняет `procedures_views.sql` (процедуры расчётов и представления отчётности);
   - заполняет БД начальными данными из `insert_initial_data.sql`.

  #### Полезные флаги скрипта `setup_database.py`
  
  | Флаг | Описание |
  |------|----------|
  | без флагов | Создать БД (если нет), таблицы, триггеры, процедуры/представления и загрузить данные |
  | `--create` | Только создать/пересоздать таблицы, триггеры и процедуры/представления (очистка схемы) |
  | `--seed` | Только загрузить начальные данные (ожидается уже созданная схема) |
  | `--init-db` | Только создать базу данных, если её нет |
  | `--fake-migrate` | Пометить миграции Django как применённые (после создания таблиц скриптом) |

5. **Примените миграции Django** (таблицы auth, sessions и т.д.)
   Таблицы приложения `airline` уже созданы скриптом выше, поэтому миграции airline нужно только отметить как применённые:
   ```bash
   cd greenquality
   python manage.py migrate --fake-initial
   cd ..
   ```
   Если появятся ошибки вида «отношение уже существует» или «колонка уже существует» на миграциях airline — выполните пометку миграций airline как применённых и снова запустите миграции:
   ```bash
   python manage.py migrate airline --fake
   python manage.py migrate
   ```

6. **Запустите сервер**
   ```bash
   cd greenquality
   python manage.py runserver
   ```
   Либо из корня: `python greenquality/manage.py runserver`

7. **Откройте сайт**  
   [http://localhost:8000](http://localhost:8000)
